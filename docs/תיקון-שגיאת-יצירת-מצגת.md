# איך לתקן: "לא ניתן ליצור מצגת" / Session invalid

## אם אתה מקבל 401 (גם אחרי התחברות מחדש)

בלוגים של Supabase רואים **POST 401** עם **execution_id: null** – כלומר ה-**gateway** של Supabase מחזיר 401 לפני שה-function בכלל רץ. כדי שה-gateway יעביר את הבקשה ל-function (והאימות ייעשה בתוך הפונקציה), צריך לכבות אימות JWT ב-gateway:

1. בטרמינל, מתוך תיקיית הפרויקט:
   ```bash
   cd ~/Desktop/interactive-lecture-hub-main
   npx supabase link --project-ref gctdhjgxrshrltbntjqj
   ```
2. העלאת הפונקציה עם **אין אימות ב-gateway** (האימות נעשה בתוך הפונקציה):
   ```bash
   npx supabase functions deploy generate-slides --no-verify-jwt
   ```
3. אם יש לך גם `chat-builder` ו-`generate-image` שמחזירות 401:
   ```bash
   npx supabase functions deploy chat-builder --no-verify-jwt
   npx supabase functions deploy generate-image --no-verify-jwt
   ```
4. אחרי ההעלאה – נסה שוב ליצור מצגת (התנתק/התחבר אם צריך).

ב-`supabase/config.toml` כבר מוגדר `verify_jwt = false` ל-generate-slides; ה-`project_id` עודכן ל-`gctdhjgxrshrltbntjqj` כדי שההגדרה תתאים לפרויקט שלך. פריסה דרך ה-CLI עם `--no-verify-jwt` מוודאת שההגדרה חלה גם בפרויקט המרוחק.

---

## אם האתר על Vercel (clasly-bay.vercel.app)

עדכנו את ה-Edge Functions כך שיקבלו את טוקן ההתחברות במפורש. **חשוב:** אחרי העדכון צריך **להעלות מחדש** את הפונקציות ל-Supabase (פעם אחת):

1. במחשב, פתח טרמינל ועבור לתיקיית הפרויקט:
   ```bash
   cd ~/Desktop/interactive-lecture-hub-main
   ```
2. הרץ:
   ```bash
   npm run deploy:functions
   ```
3. אם מבקשים התחברות ל-Supabase – התחבר עם החשבון שמנהל את הפרויקט.
4. **מומלץ** אחרי זה להריץ גם (כדי לכבות אימות ב-gateway אם אתה מקבל 401):
   ```bash
   npx supabase functions deploy generate-slides --no-verify-jwt
   npx supabase functions deploy chat-builder --no-verify-jwt
   npx supabase functions deploy generate-image --no-verify-jwt
   ```
5. אחרי שהפקודה מסתיימת בהצלחה, נסה שוב ליצור מצגת באתר (התנתק והתחבר אם צריך, ואז "יצור מצגת עם AI").

---

## אין צורך למחוק שום דבר ב-Secrets

ב-**Edge Functions → Secrets** אצלך מופיעים:
- GEMINI_API_KEY  
- SUPABASE_URL  
- SUPABASE_ANON_KEY  
- SUPABASE_SERVICE_ROLE_KEY  
- SUPABASE_DB_URL  

**אל תמחק אותם.** Supabase משתמש בהם, ולפעמים אי אפשר למחוק – וזה בסדר. תשאיר הכל כמו שזה.

---

## מה לעשות (3 צעדים פשוטים)

### שלב 1: לוחצים על הכפתור באתר

כשמופיעה השגיאה על יצירת מצגת, יופיע גם **כפתור**:

**"התנתק והתחבר"**

- לוחצים עליו.  
- זה מנתק אותך מהאתר (Sign out).

---

### שלב 2: מתחברים שוב

אחרי שניתקת:

- תופיע אפשרות **Sign in** / **התחבר**.  
- נכנסים עם **אותו חשבון** שהשתמשת בו קודם (אימייל או Google).  
- מחכים עד שאתה רואה שאתה מחובר (שם המשתמש או התמונה מופיעים).

---

### שלב 3: יוצרים מצגת שוב

- נכנסים שוב ל**יצירת מצגת עם AI** (אותו מקום כמו קודם).  
- מזינים נושא ולוחצים **יצירה**.  
- עכשיו זה אמור לעבוד.

---

## אם עדיין לא עובד

אז מנקים את הנתונים של האתר **בדפדפן** (פעם אחת):

1. **פותחים את האתר** (אותו חלון שבו אתה משתמש).
2. **לוחצים F12** על המקלדת (נפתח חלון למפתחים).
3. **בוחרים למעלה את הלשונית "Application"** (או "אפליקציה" / "Storage" אם השפה שונה).
4. **בצד שמאל** מחפשים **"Local Storage"** ובוחרים את הכתובת של האתר (למשל `http://localhost:5173` או הכתובת האמיתית של האתר).
5. **לוחצים עם כפתור ימני** על הרשימה → **"Clear"** או **"מחק"** (לנקות את כל הרשומות שם).
6. **סוגרים את חלון המפתחים** (או לוחצים F12 שוב).
7. **מרעננים את הדף** (F5 או כפתור הרענון).
8. **מתחברים מחדש** (Sign in) ו**יוצרים מצגת** שוב.

---

## סיכום

- **ב-Secrets – לא מוחקים כלום.**  
- **באתר – לוחצים "התנתק והתחבר" כשמופיעה השגיאה, מתחברים שוב, ומייצרים מצגת.**  
- אם זה לא עזר – מנקים Local Storage (השלב עם F12) ומתחברים שוב.
