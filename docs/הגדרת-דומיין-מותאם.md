# מדריך מעבר לדומיין מותאם (Custom Domain) ב-Supabase

כשמשדרגים ל-Supabase Pro ומגדירים Custom Domain, המשתמשים יראו בדפדפן את הדומיין שלך במקום `gctdhjgxrshrltbntjqj.supabase.co`. המדריך הזה מסביר מה לעדכן בכל מערכת.

---

## 1. הגדרת Custom Domain ב-Supabase (מסך שהצטרפת)

### 1.1 הוספת הדומיין

1. עבור ל-**Supabase Dashboard** → **Project Settings** → **Custom Domains** (או **General** → **Custom Domains**)
2. בשדה **Custom domain** הזן את הסאב-דומיין שבחרת, למשל:
   - `api.yourdomain.com`
   - `supabase.yourdomain.com`
   - לא ניתן להשתמש ב-root domain (`yourdomain.com`) – חייב להיות subdomain

### 1.2 הגדרת CNAME ב-DNS

1. ב-DNS של הדומיין שלך (GoDaddy, Cloudflare, Namecheap וכו') צור רשומת **CNAME**:
   - **Name/Host:** `api` (או השם שבחרת – אם הזנת `api.yourdomain.com` אז `api`)
   - **Value/Target:** `gctdhjgxrshrltbntjqj.supabase.co`
   - **TTL:** מומלץ נמוך (למשל 300) כדי לאפשר שינויים מהירים

2. אם אתה משתמש ב-**Cloudflare** – כבה את ה-Proxy (הפוך ל-DNS only, אייקון אפור).

### 1.3 אימות (אם נדרש)

Supabase עשוי לבקש רשומות TXT לאימות. אם מופיעות – הוסף אותן ב-DNS והמתן לאימות.

### 1.4 הפעלת הדומיין

לחץ על **Add** / **Verify** ב-Supabase. כשהאימות הצליח, הדומיין המותאם יהיה פעיל.

---

## 2. הגדרות Auth ב-Supabase

עבור ל-**Authentication** → **URL Configuration**:

### 2.1 Site URL

- **Site URL:** כתובת האפליקציה הראשית שלך (דומיין ה-Vercel או הדומיין המותאם שלך), למשל:
  - `https://yourdomain.com`
  - או `https://app.yourdomain.com`
  - או `https://your-app.vercel.app` (אם עדיין משתמש ב-vercel.app)

### 2.2 Redirect URLs

הוסף את כל הכתובות שמהן המשתמשים חוזרים אחרי התחברות:

- `https://yourdomain.com/**`
- `https://app.yourdomain.com/**` (אם שונה מ-Site URL)
- `https://your-app.vercel.app/**` (אם רלוונטי)
- `http://localhost:5173/**` (פיתוח)
- `https://*-your-app.vercel.app/**` (אם יש Preview deployments ב-Vercel)

---

## 3. Google Cloud Console (OAuth)

כדי שהמשתמשים יראו "המשך אל api.yourdomain.com" במקום Supabase:

1. עבור ל-[Google Cloud Console](https://console.cloud.google.com/) → **APIs & Services** → **Credentials**
2. פתח את ה-OAuth 2.0 Client ID שבו אתה משתמש (Web application)
3. תחת **Authorized redirect URIs** הוסף:
   ```
   https://api.yourdomain.com/auth/v1/callback
   ```
   (החלף `api.yourdomain.com` בדומיין המותאם שלך)
4. אפשר להשאיר גם את ה-URI הישן:
   ```
   https://gctdhjgxrshrltbntjqj.supabase.co/auth/v1/callback
   ```
   אם תרצה גיבוי.
5. תחת **Authorized JavaScript origins** ודא שיש:
   - כתובת האפליקציה (למשל `https://yourdomain.com`)
   - `http://localhost:5173` לפיתוח

---

## 4. PayPal

אם אתה משתמש ב-Webhook של PayPal:

1. עבור ל-[PayPal Developer](https://developer.paypal.com/) → **Apps & Credentials** → בחר את האפליקציה
2. עבור ל-**Webhooks** → ערוך את ה-Webhook הקיים (או צור חדש)
3. עדכן את **Webhook URL** מ:
   ```
   https://gctdhjgxrshrltbntjqj.supabase.co/functions/v1/paypal-webhook
   ```
   ל:
   ```
   https://api.yourdomain.com/functions/v1/paypal-webhook
   ```
   (החלף בדומיין המותאם שלך)
4. שמור את השינויים.

---

## 5. Vercel (משתני סביבה)

1. עבור ל-**Vercel** → הפרויקט → **Settings** → **Environment Variables**
2. עדכן את **VITE_SUPABASE_URL** מ:
   ```
   https://gctdhjgxrshrltbntjqj.supabase.co
   ```
   ל:
   ```
   https://api.yourdomain.com
   ```
   (החלף בדומיין המותאם שלך)
3. ודא שהמשתנה מוגדר ל-**Production** (ול-Preview/Development אם נדרש)
4. בצע **Redeploy** לפרויקט (Deployments → ⋮ → Redeploy)

---

## 6. קבצי .env מקומיים

ב-`.env` וב-`.env.local` עדכן:

```
VITE_SUPABASE_URL=https://api.yourdomain.com
```

(השאר את `VITE_SUPABASE_PUBLISHABLE_KEY` כפי שהוא – אין צורך לשנותו)

---

## 7. סדר הפעולות המומלץ

1. הוסף CNAME ב-DNS (לפני הפעלת הדומיין ב-Supabase)
2. הוסף את הדומיין המותאם ב-Supabase והמתן לאימות
3. עדכן **Site URL** ו-**Redirect URLs** ב-Supabase Auth
4. הוסף **Authorized redirect URI** בדומיין המותאם ב-Google Cloud
5. עדכן **Webhook URL** ב-PayPal
6. עדכן **VITE_SUPABASE_URL** ב-Vercel וב-`.env`
7. בצע Redeploy ל-Vercel

---

## 8. בדיקות לאחר המעבר

- התחברות עם Google – וודא שהמסך מציג את הדומיין שלך
- התחברות עם אימייל/סיסמה – אם משתמש
- רכישת קרדיטים / מנוי – וודא ש-PayPal עובד
- יצירת מצגת עם AI – וודא שה-Edge Functions נגישות

---

## 9. אם משהו לא עובד

- **"Invalid OAuth redirect URL"** – ודא שהדומיין המותאם נוסף ל-Redirect URLs ב-Supabase Auth
- **PayPal לא מקבל אירועים** – ודא ש-Webhook URL מעודכן ונכון
- **CORS או 404** – ודא ש-`VITE_SUPABASE_URL` מצביע לדומיין המותאם בכל הסביבות (לוקאלי, Vercel)
